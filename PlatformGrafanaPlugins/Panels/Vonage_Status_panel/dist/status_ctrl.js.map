{"version":3,"sources":["../src/status_ctrl.js"],"names":["MetricsPanelCtrl","_","TimeSeries","coreModule","kbn","moment","panelDefaults","flipCard","flipTime","fontsize","ok_text","warning_text","critical_text","flipheight","flipwidth","colorMode","colors","crit","warn","ok","disable","isGrayOnNoData","isIgnoreOKColors","isHideAlertsOnDisable","cornerRadius","isAutoScrollOnOverflow","StatusPluginCtrl","$scope","$injector","$log","$filter","annotationsSrv","defaultsDeep","panel","filter","valueHandlers","aggregations","displayTypes","displayAliasTypes","displayValueTypes","colorModes","fontFormats","measurementArray","previousQuery","ok_varibale","warn_varibale","crit_varibale","gridPos","h","w","each","targets","t","valueHandler","Date","length","inSightsStatusData","events","on","onRender","bind","postRefresh","onDataError","onDataReceived","onInitEditMode","onColorChange","addFilters","numberOrTextFilter","input","angular","isNumber","$stateful","textRegex","regex","RegExp","e","matchResults","match","fixedSpan","span","target","series","i","result","find","fruit","label","undefined","obj","Object","assign","push","measurements","duplicates","measurement","hide","m","res","alias","addEditorTab","unitFormats","getUnitFormats","subItem","units","value","render","panelHeaderHeight","title","$panelContainer","css","$panelContoller","height","minHeight","tail","panelWidth","innerWidth","isNaN","parseInt","slice","maxWidth","element","overflowY","offsetHeight","scrollHeight","Number","String","c","getTime","item","color","fixPanelHeader","setElementHeight","setTextMaxWidth","upgradeOldVersion","clusterName","displayName","replace","namePrefix","addClass","removeClass","disabled","display","annotation","extraMoreAlerts","s","datapoints","showcase","url","isDisplayValue","displayType","valueDisplayRegex","validateRegex","str","aggregation","max","point","stats","min","diff","total","avg","toString","display_value","handleThresholdStatus","handleDisabledStatus","handleTextOnly","autoFlip","updatePanelState","handleCssDisplay","parseUri","handleMaxAlertsToShow","displayAliasType","displayValueWithAlias","isFloat","thresholds","parseThresholds","inverted","isCritical","isWarning","isCheckRanges","warnIsNumber","critIsNumber","formatDisplayValue","displayValueWhenAliasDisplayed","displayValueFromWarning","displayValueFromCritical","isFinite","decimals","decimalPlaces","Math","valueFormats","date","dashboard","isTimezoneUtc","utc","format","dateFormat","num","disabledValue","panelState","radius","okColor","maxAlertNumber","currentMaxAllowedAlerts","filteredOutAlerts","arrayNamesToSlice","forEach","originAlertCount","arrayName","links","link","type","uri","dashUri","params","targetBlank","dataList","map","seriesHandler","timeoutId","clearInterval","setInterval","toggleClass","scope","elem","attrs","ctrl","metricOptions","parseFloat","valueOf","val","toLowerCase","indexOf","seriesData","flotpairs","getFlotPairs","templateUrl"],"mappings":"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","file":"status_ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from \"app/plugins/sdk\";\r\nimport _ from \"lodash\";\r\nimport TimeSeries from \"app/core/time_series2\";\r\nimport coreModule from \"app/core/core_module\";\r\nimport kbn from \"app/core/utils/kbn\";\r\nimport moment from \"moment\";\r\n\r\nimport './css/status_panel.css!';\r\n\r\n/*\t\r\n\tAdded / Removed Code on top of grafana status panel code - is mention where extra code changes have been done to support Neo4j Datasource requirements.\t\r\n*/\r\n\r\n\r\n\r\n// Set and populate panel defaults\r\nconst panelDefaults = {\r\n\tflipCard: false,\r\n\tflipTime: 5,\r\n\tfontsize:'100%',\r\n\tok_text:'OK',\r\n\twarning_text:'Warning',\r\n\tcritical_text:'Critical',\r\n\tflipheight:'300',\r\n\tflipwidth:'300',\r\n\tcolorMode: 'Panel',\r\n\t// Changed colors to match Table Panel so colorised text is easier to read\r\n\tcolors: {\r\n\t\tcrit: 'rgba(245, 54, 54, 0.9)',\r\n\t\twarn: 'rgba(237, 129, 40, 0.9)',\r\n\t\tok: 'rgba(50, 128, 45, 0.9)',\r\n\t\tdisable: 'rgba(128, 128, 128, 0.9)'\r\n\t},\r\n\tisGrayOnNoData: false,\r\n\tisIgnoreOKColors: false,\r\n\tisHideAlertsOnDisable: false,\r\n\tcornerRadius: 0,\r\n\tisAutoScrollOnOverflow: false\r\n};\r\n\r\nexport class StatusPluginCtrl extends MetricsPanelCtrl {\r\n\t/** @ngInject */\r\n\tconstructor($scope, $injector, $log, $filter, annotationsSrv) {\r\n\t\tsuper($scope, $injector);\r\n\t\t_.defaultsDeep(this.panel, panelDefaults);\r\n\r\n\t\t//this.log = $log.debug;\r\n\t\tthis.filter = $filter;\r\n\r\n\t\tthis.valueHandlers = ['Number Threshold', 'String Threshold', 'Date Threshold', 'Disable Criteria', 'Text Only'];\r\n\t\tthis.aggregations = ['Last', 'First', 'Max', 'Min', 'Sum', 'Avg', 'Delta', 'All'];\r\n\t\tthis.displayTypes = ['Regular', 'Annotation'];\r\n\t\tthis.displayAliasTypes = ['Warning / Critical', 'Always'];\r\n\t\tthis.displayValueTypes = ['Never', 'When Alias Displayed', 'Warning / Critical', 'Critical Only'];\r\n\t\tthis.colorModes = ['Panel', 'Metric', 'Disabled'];\r\n\t\tthis.fontFormats = ['Regular', 'Bold', 'Italic'];\r\n\t\t\r\n\t\t/*\tAdded Code on top of grafana status panel code.\t*/\r\n\t\tthis.measurementArray = [];\r\n\t\tthis.previousQuery = '';\r\n\t\tthis.ok_varibale = true;\r\n\t\tthis.warn_varibale = false;\r\n\t\tthis.crit_varibale = false;\r\n\t\t\r\n\t\tthis.panel.flipheight = this.panel.gridPos.h * 50 + 'px' || '300px';\r\n\t\tthis.panel.flipwidth = this.panel.gridPos.w * 50 + 'px' || '300px';\r\n\t\t\r\n\t\t\r\n\t\t/*\tAdded Code on top of grafana status panel code.\t*/\r\n\r\n\t\t// Dates get stored as strings and will need to be converted back to a Date objects\r\n\t\t_.each(this.panel.targets, (t) => {\r\n\t\t\tif (t.valueHandler === \"Date Threshold\") {\r\n\t\t\t\tif (typeof t.crit != \"undefined\") t.crit = new Date(t.crit);\r\n\t\t\t\tif (typeof t.warn != \"undefined\") t.warn = new Date(t.warn);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.panel.flipTime = this.panel.flipTime || 5;\r\n\t\t\r\n\t\t/*\tAdded Code on top of grafana status panel code.\t*/\r\n\t\tif(this.measurementArray.length == 0)\r\n\t\t{\r\n\t\t\tif(\"inSightsStatusData\" in this.panel && this.panel.inSightsStatusData.length > 0)\r\n\t\t\t{\r\n\t\t\t\tthis.measurementArray = this.panel.inSightsStatusData;\r\n\t\t\t}\r\n\t\t}\r\n\t\t/*\tAdded Code on top of grafana status panel code.\t*/\r\n\r\n\t\t/** Bind events to functions **/\r\n\t\tthis.events.on('render', this.onRender.bind(this));\r\n\t\tthis.events.on('refresh', this.postRefresh.bind(this));\r\n\t\tthis.events.on('data-error', this.onDataError.bind(this));\r\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\r\n\t\tthis.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\r\n\t\tthis.onColorChange = this.onColorChange.bind(this);\r\n\r\n\t\tthis.addFilters()\r\n\t}\r\n\r\n\taddFilters() {\r\n\t\tcoreModule.filter('numberOrText', () => {\r\n\t\t\tlet numberOrTextFilter = (input) => {\r\n\t\t\t\tif(angular.isNumber(input)) {\r\n\t\t\t\t\treturn this.filter('number')(input);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn input;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tnumberOrTextFilter.$stateful = true;\r\n\t\t\treturn numberOrTextFilter;\r\n\t\t});\r\n\r\n\t\tcoreModule.filter('numberOrTextWithRegex', () => {\r\n\t\t\tlet numberOrTextFilter = (input, textRegex) => {\r\n\t\t\t\tif(angular.isNumber(input)) {\r\n\t\t\t\t\treturn this.filter('number')(input);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(textRegex == null || textRegex.length == 0) {\r\n\t\t\t\t\t\treturn input;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet regex;\r\n\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tregex = new RegExp(textRegex);\r\n\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\treturn input;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!input) {\r\n\t\t\t\t\t\t\treturn input;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tlet matchResults = input.match(regex);\r\n\t\t\t\t\t\tif (matchResults == null) {\r\n\t\t\t\t\t\t\treturn input;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn matchResults[0];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tnumberOrTextFilter.$stateful = true;\r\n\t\t\treturn numberOrTextFilter;\r\n\t\t});\r\n\t}\r\n\r\n\tpostRefresh() {\r\n\t\tif (this.panel.fixedSpan) {\r\n\t\t\tthis.panel.span = this.panel.fixedSpan;\r\n\t\t}\r\n\t\t/*\tAdded Code on top of grafana status panel code.\t*/\r\n\t\t//\tChecking weather query is modified or not.\r\n\t\t\r\n\t\tif(this.panel.targets.length == 1 && this.previousQuery != '')\r\n\t\t{\r\n\t\t\tif(this.previousQuery != this.panel.targets[0].target)\r\n\t\t\t{\r\n\t\t\t\tthis.measurementArray = [];\r\n\t\t\t\tthis.panel.inSightsStatusData = [];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(this.panel.targets.length > 0 && this.measurementArray.length < this.series.length)\r\n\t\t{\r\n\t\t\tfor(let i = 0; i < this.series.length; i++) \r\n\t\t\t{\r\n\t\t\t\tconst result = this.measurementArray.find( fruit => fruit.label === this.series[i].label );\r\n\t\t\t\tif(result == undefined)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar obj = Object.assign(this.series[i], this.panel.targets[0]);\r\n\t\t\t\t\tthis.measurementArray.push(obj); \r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//\tAssigning the query to static variable to check modification of query in next iteration.\r\n\t\tif(this.panel.targets.length == 1)\r\n\t\t{\r\n\t\t\tthis.previousQuery = this.panel.targets[0].target;\r\n\t\t}\r\n\t\tthis.measurements = this.measurementArray;\r\n\t\t/*\tAdded Code on top of grafana status panel code.\t*/\r\n\t\t\r\n\t\t\r\n\t\t/** Duplicate alias validation **/\r\n\t\tthis.duplicates = false;\r\n\r\n\t\tthis.measurements = _.filter(this.measurements, (measurement) => {\r\n\t\t\treturn !measurement.hide;\r\n\t\t});\r\n\r\n\t\t_.each(this.measurements, (m) => {\r\n\t\t\tlet res = _.filter(this.measurements, (measurement) => {\r\n\t\t\t\t\r\n\t\t\t\t/*\tRemoved Code on top of grafana status panel code.\t*/\r\n\t\t\t\treturn (m.alias == measurement.alias) && !m.hide;\r\n\t\t\t\t/*\tRemoved Code on top of grafana status panel code.\t*/\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t});\r\n\r\n\t\t\tif (res.length > 1) {\r\n\t\t\t\tthis.duplicates = true;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tonInitEditMode() {\r\n\t\tthis.addEditorTab('Options', 'public/plugins/vonage-status-panel/editor.html', 2);\r\n\t\t// Load in the supported units-of-measure formats so they can be displayed in the editor\r\n\t\tthis.unitFormats = kbn.getUnitFormats();\r\n\t}\r\n\r\n\tsetUnitFormat(measurement, subItem) {\r\n\t\tmeasurement.units = subItem.value;\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tfixPanelHeader() {\r\n\t\t// Handle the panel top menu height, since it's display doesn't look good with the panel\r\n\t\tlet panelHeaderHeight = '';\r\n\t\tif(this.panel.title.length === 0) {\r\n\t\t\tpanelHeaderHeight = '10px';\r\n\t\t}\r\n\t\tthis.$panelContainer.find('.panel-header').css('height', panelHeaderHeight);\r\n\t\tthis.$panelContainer.find('.panel-menu-container').css('height', panelHeaderHeight);\r\n\t\tthis.$panelContainer.find('.fa-caret-down').css('display', 'none');\r\n\t}\r\n\r\n\tsetElementHeight() {\r\n\t\t// Handle the panel height\r\n\t\tthis.$panelContainer.find('.status-panel').css('min-height', this.$panelContoller.height + 'px');\r\n\t\tthis.minHeight = this.$panelContoller.height-10;\r\n\t}\r\n\r\n\tsetTextMaxWidth() {\r\n\t\tlet tail = ' …';\r\n\t\tlet panelWidth = this.$panelContainer.innerWidth();\r\n\t\tif (isNaN(panelWidth))\r\n\t\t\tpanelWidth = parseInt(panelWidth.slice(0, -2), 10) / 12;\r\n\t\tpanelWidth = panelWidth - 20;\r\n\t\tthis.maxWidth = panelWidth;\r\n\t}\r\n\r\n\tisAutoScrollAlerts() {\r\n\t\tif(!this.panel.isAutoScrollOnOverflow) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tlet element = this.$panelContainer.find('.status-panel')[0];\r\n\t\tlet overflowY = element.offsetHeight < element.scrollHeight;\r\n\t\treturn overflowY;\r\n\t}\r\n\r\n\tonHandlerChange(measurement) {\r\n\t\t// If the Threshold type changes between Number/String/Date then try and recast the thresholds to keep consistent\r\n\t\tif (measurement.valueHandler === \"Number Threshold\") {\r\n\t\t\tmeasurement.crit = (isNaN(Number(measurement.crit))) ? undefined : Number(measurement.crit);\r\n\t\t\tmeasurement.warn = (isNaN(Number(measurement.warn))) ? undefined : Number(measurement.warn);\r\n\t\t} else if (measurement.valueHandler === \"String Threshold\") {\r\n\t\t\tif (typeof measurement.crit != \"undefined\") measurement.crit = String(measurement.crit);\r\n\t\t\tif (typeof measurement.warn != \"undefined\") measurement.warn = String(measurement.warn);\r\n\t\t} else if (measurement.valueHandler === \"Date Threshold\") {\r\n\t\t\tlet c = new Date(measurement.crit), w = new Date(measurement.warn);\r\n\t\t\tmeasurement.crit = (isNaN(c.getTime())) ? undefined : c;\r\n\t\t\tmeasurement.warn = (isNaN(w.getTime())) ? undefined : w;\r\n\t\t}\r\n\t\tthis.onRender();\r\n\t}\r\n\r\n\tonColorChange(item) {\r\n\t\treturn (color) => {\r\n\t\t\tthis.panel.colors[item] = color;\r\n\t\t\tthis.render();\r\n\t\t};\r\n\t}\r\n\r\n\tonRender() {\r\n\t\tthis.fixPanelHeader();\r\n\t\tthis.setElementHeight();\r\n\t\tthis.setTextMaxWidth();\r\n\t\tthis.upgradeOldVersion();\r\n\r\n\t\tif (this.panel.clusterName) {\r\n\t\t\tthis.panel.displayName =\r\n\t\t\t\tthis.filter('interpolateTemplateVars')(this.panel.clusterName, this.$scope)\r\n\t\t\t\t\t.replace(new RegExp(this.panel.namePrefix, 'i'), '');\r\n\t\t} else {\r\n\t\t\tthis.panel.displayName = \"\";\r\n\t\t}\r\n\r\n\t\tif(this.panel.flipCard){\r\n\t\t\tthis.$panelContainer.addClass(\"effect-hover\");\r\n\t\t} else {\r\n\t\t\tthis.$panelContainer.removeClass(\"effect-hover\");\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t/*\tAdded Code on top of grafana status panel code.\t*/\r\n\t\tlet targets = [];\r\n\t\tthis.measurements = this.measurementArray;\r\n\t\tif(this.measurements.length > 0)\r\n\t\t{\r\n\t\t\ttargets = this.measurements;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\ttargets = this.panel.targets;\r\n\t\t}\r\n\t\tthis.inSightsStatusData = this.measurements;\r\n\t\tif (\"inSightsStatusData\" in this.panel && this.panel.inSightsStatusData.length > 0)\r\n\t\t{\r\n\t\t\tthis.inSightsStatusData = this.panel.inSightsStatusData;\r\n\t\t}\r\n\t\telse \r\n\t\t{\r\n\t\t\t//this.inSightsStatusData = [];\r\n\t\t\tthis.panel.inSightsStatusData = this.inSightsStatusData;\r\n\t\t}\r\n\t\t//let targets = this.panel.targets;\r\n\t\t/*\tAdded Code on top of grafana status panel code.\t*/\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tthis.crit = [];\r\n\t\tthis.warn = [];\r\n\t\tthis.disabled = [];\r\n\t\tthis.display = [];\r\n\t\tthis.annotation = [];\r\n\t\tthis.extraMoreAlerts = null;\r\n\r\n\t\t_.each(this.series, (s) => {\r\n\t\t\tif (s.datapoints.length === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet target = _.find(targets, (target) => {\r\n\t\t\t\treturn target.alias == s.alias || target.target == s.alias;\r\n\t\t\t});\r\n\r\n\t\t\tif (!target) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\ts.alias = target.alias;\r\n\t\t\t\r\n\t\t\t/*\tAdded Code on top of grafana status panel code.\t*/\r\n\t\t\ts.showcase = target.showcase;\r\n\t\t\t/*\tAdded Code on top of grafana status panel code.\t*/\r\n\t\t\t\r\n\t\t\ts.url = target.url;\r\n\t\t\ts.isDisplayValue = true;\r\n\t\t\ts.displayType = target.displayType;\r\n\t\t\ts.valueDisplayRegex = \"\";\r\n\r\n\t\t\tif(this.validateRegex(target.valueDisplayRegex)) {\r\n\t\t\t\ts.valueDisplayRegex = target.valueDisplayRegex;\r\n\t\t\t}\r\n\r\n\t\t\tlet value;\r\n\t\t\tlet str;\r\n\t\t\tswitch (target.aggregation) {\r\n\t\t\t\tcase 'Max':\r\n\t\t\t\t\tvalue = _.max(s.datapoints, (point) => { return point[0]; })[0];\r\n\t\t\t\t\tvalue = s.stats.max;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Min':\r\n\t\t\t\t\tvalue = _.min(s.datapoints, (point) => { return point[0]; })[0];\r\n\t\t\t\t\tvalue = s.stats.min;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Delta':\r\n\t\t\t\t\tvalue = s.datapoints[s.datapoints.length - 1][0] - s.datapoints[0][0];\r\n\t\t\t\t\tvalue = s.stats.diff;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Sum':\r\n\t\t\t\t\tvalue = 0;\r\n\t\t\t\t\t_.each(s.datapoints, (point) => { value += point[0] });\r\n\t\t\t\t\tvalue = s.stats.total;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Avg':\r\n\t\t\t\t\tvalue = s.stats.avg;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'First':\r\n\t\t\t\t\tvalue = s.datapoints[0][0];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'All':\r\n\t\t\t\t\t//value = s.datapoints[0][0];\r\n\t\t\t\t\tstr = '';\r\n\t\t\t\t\t_.each(s.datapoints, (point) => \r\n\t\t\t\t\t{ \r\n\t\t\t\t\t\tstr = str + \" \\n\" + (point[0]).toString();\r\n\t\t\t\t\t});\r\n\t\t\t\t\tvalue = str;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tvalue = s.datapoints[s.datapoints.length - 1][0];\r\n\t\t\t}\r\n\r\n\t\t\ts.display_value = value;\r\n\r\n\t\t\tif (target.valueHandler == \"Number Threshold\" ||\r\n\t\t\t\ttarget.valueHandler == \"String Threshold\" ||\r\n\t\t\t\ttarget.valueHandler == \"Date Threshold\") {\r\n\t\t\t\tthis.handleThresholdStatus(s, target);\r\n\t\t\t}\r\n\t\t\telse if (target.valueHandler == \"Disable Criteria\") {\r\n\t\t\t\tthis.handleDisabledStatus(s,target);\r\n\t\t\t}\r\n\t\t\telse if (target.valueHandler == \"Text Only\") {\r\n\t\t\t\tthis.handleTextOnly(s, target);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif(this.panel.isHideAlertsOnDisable && this.disabled.length > 0) {\r\n\t\t\tthis.crit = [];\r\n\t\t\tthis.warn = [];\r\n\t\t\tthis.display = [];\r\n\t\t}\r\n\r\n\t\tthis.autoFlip();\r\n\t\tthis.updatePanelState();\r\n\t\tthis.handleCssDisplay();\r\n\t\tthis.parseUri();\r\n\r\n\t\t//This must appear after handling the css style of the panel\r\n\t\tthis.handleMaxAlertsToShow();\r\n\t}\r\n\r\n\tupgradeOldVersion() {\r\n\t\tlet targets = this.panel.targets;\r\n\r\n\t\t//Handle legacy code\r\n\t\t_.each(targets, (target) => {\r\n\t\t\tif(target.valueHandler == null) {\r\n\t\t\t\tif(target.displayType != null) {\r\n\t\t\t\t\ttarget.valueHandler = target.displayType;\r\n\t\t\t\t\tif (target.valueHandler == \"Annotation\") {\r\n\t\t\t\t\t\ttarget.valueHandler = \"Text Only\"\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttarget.valueHandler = this.valueHandlers[0]\r\n\t\t\t\t}\r\n\t\t\t\ttarget.displayType = this.displayTypes[0];\r\n\t\t\t}\r\n\r\n\t\t\tif(target.display != null){\r\n\t\t\t\ttarget.displayAliasType = target.display ? \"Always\" : this.displayAliasTypes[0];\r\n\t\t\t\ttarget.displayValueWithAlias = target.display ? 'When Alias Displayed' : this.displayValueTypes[0];\r\n\t\t\t\tdelete target.display;\r\n\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Depreciate Threshold in favour of Type specific versions\r\n\t\t_.each(targets, (target) => {\r\n\t\t\tif (target.valueHandler === \"Threshold\") {\r\n\t\t\t\t// Use the same logic as Threshold Parsing to ensure we retain same behaviour\r\n\t\t\t\t// i.e. map to Number Threshold if two floats (i.e. range check) otherwise map to String Threshold (i.e. exact match)\r\n\t\t\t\tif (StatusPluginCtrl.isFloat(target.crit) && StatusPluginCtrl.isFloat(target.warn)) {\r\n\t\t\t\t\ttarget.valueHandler = \"Number Threshold\"\r\n\t\t\t\t\ttarget.crit = Number(target.crit);\r\n\t\t\t\t\ttarget.warn = Number(target.warn);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttarget.valueHandler = \"String Threshold\"\r\n\t\t\t\t\tif (typeof target.crit != \"undefined\") target.crit = String(target.crit);\r\n\t\t\t\t\tif (typeof target.warn != \"undefined\") target.warn = String(target.warn);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\thandleThresholdStatus(series, target) {\r\n\t\tseries.thresholds = StatusPluginCtrl.parseThresholds(target);\r\n\t\tseries.inverted = series.thresholds.crit < series.thresholds.warn;\r\n\r\n\t\tlet isCritical = false;\r\n\t\tlet isWarning = false;\r\n\t\tlet isCheckRanges = series.thresholds.warnIsNumber && series.thresholds.critIsNumber;\r\n\t\tif (isCheckRanges) {\r\n\t\t\tif (!series.inverted) {\r\n\t\t\t\tif (series.display_value >= series.thresholds.crit) {\r\n\t\t\t\t\tisCritical = true\r\n\t\t\t\t} else if (series.display_value >= series.thresholds.warn) {\r\n\t\t\t\t\tisWarning = true\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (series.display_value <= series.thresholds.crit) {\r\n\t\t\t\t\tisCritical = true\r\n\t\t\t\t} else if (series.display_value <= series.thresholds.warn) {\r\n\t\t\t\t\tisWarning = true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (series.display_value == series.thresholds.crit) {\r\n\t\t\t\tisCritical = true\r\n\t\t\t} else if (series.display_value == series.thresholds.warn) {\r\n\t\t\t\tisWarning = true\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Add units-of-measure and decimal formatting or date formatting as needed\r\n\t\tseries.display_value = this.formatDisplayValue(series.display_value, target);\r\n\r\n\t\tlet displayValueWhenAliasDisplayed = 'When Alias Displayed' === target.displayValueWithAlias;\r\n\t\tlet displayValueFromWarning = 'Warning / Critical' === target.displayValueWithAlias;\r\n\t\tlet displayValueFromCritical = 'Critical Only' === target.displayValueWithAlias;\r\n\r\n\t\tif(isCritical) {\r\n\t\t\t//In critical state we don't show the error as annotation\r\n\t\t\tseries.displayType = this.displayTypes[0];\r\n\t\t\tseries.isDisplayValue = displayValueWhenAliasDisplayed || displayValueFromWarning || displayValueFromCritical;\r\n\t\t\tthis.crit.push(series);\r\n\t\t} else if(isWarning) {\r\n\t\t\t//In warning state we don't show the warning as annotation\r\n\t\t\tseries.displayType = this.displayTypes[0];\r\n\t\t\tseries.isDisplayValue = displayValueWhenAliasDisplayed || displayValueFromWarning;\r\n\t\t\tthis.warn.push(series);\r\n\t\t} else if (\"Always\" == target.displayAliasType) {\r\n\t\t\tseries.isDisplayValue = displayValueWhenAliasDisplayed;\r\n\t\t\tif(series.displayType == \"Annotation\") {\r\n\t\t\t\tthis.annotation.push(series);\r\n\t\t\t} else {\r\n\t\t\t\tthis.display.push(series);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tformatDisplayValue(value, target) {\r\n\t\t// Format the display value. Set to \"Invalid\" if value is out-of-bounds or a type mismatch with the handler\r\n\t\tif (target.valueHandler === \"Number Threshold\") {\r\n\t\t\tif (_.isFinite(value)) {\r\n\t\t\t\tlet units = (typeof target.units === \"string\") ? target.units : 'none';\r\n\t\t\t\tlet decimals = this.decimalPlaces(value);\r\n\t\t\t\t// We define the decimal percision by the minimal decimal needed\r\n\t\t\t\tdecimals = (typeof target.decimals === \"number\") ? Math.min(target.decimals, decimals) : decimals;\r\n\t\t\t\tvalue = kbn.valueFormats[units](value, decimals, null);\r\n\t\t\t} else {\r\n\t\t\t\tvalue = \"Invalid Number\";\r\n\t\t\t}\r\n\t\t} else if (target.valueHandler === \"String Threshold\") {\r\n\t\t\tif (value === undefined || value === null || value !== value)\r\n\t\t\t\tvalue = \"Invalid String\";\r\n\t\t} else if (target.valueHandler === \"Date Threshold\") {\r\n\t\t\tif (_.isFinite(value)) {\r\n\t\t\t\tlet date = moment(new Date(value));\r\n\t\t\t\tif (this.dashboard.isTimezoneUtc()) date = date.utc();\r\n\t\t\t\tvalue = date.format(target.dateFormat);\r\n\t\t\t} else {\r\n\t\t\t\tvalue = \"Invalid Date\";\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\tdecimalPlaces(num) {\r\n\t\tvar match = (''+num).match(/(?:\\.(\\d+))?(?:[eE]([+-]?\\d+))?$/);\r\n\t\tif (!match) { return 0; }\r\n\t\treturn Math.max(\r\n\t\t\t0,\r\n\t\t\t// Number of digits right of decimal point.\r\n\t\t\t(match[1] ? match[1].length : 0)\r\n\t\t\t// Adjust for scientific notation.\r\n\t\t\t- (match[2] ? +match[2] : 0));\r\n\t}\r\n\r\n\thandleDisabledStatus(series, target) {\r\n\t\tseries.displayType = this.displayTypes[0];\r\n\t\tseries.disabledValue = target.disabledValue;\r\n\r\n\t\tif (series.display_value == series.disabledValue) {\r\n\t\t\tthis.disabled.push(series);\r\n\t\t}\r\n\t}\r\n\r\n\thandleTextOnly(series, target) {\r\n\t\tif(series.displayType == \"Annotation\") {\r\n\t\t\tthis.annotation.push(series);\r\n\t\t} else {\r\n\t\t\tthis.display.push(series);\r\n\t\t}\r\n\t}\r\n\r\n\tupdatePanelState() {\r\n\t\tif(this.duplicates) {\r\n\t\t\tthis.panelState = 'error-state';\r\n\t\t} else if (this.disabled.length > 0) {\r\n\t\t\tthis.panelState = 'disabled-state';\r\n\t\t} else if (this.crit.length > 0) {\r\n\t\t\tthis.panelState = 'error-state';\r\n\t\t} else if (this.warn.length > 0) {\r\n\t\t\tthis.panelState = 'warn-state';\r\n\t\t} else if((this.series == undefined || this.series.length == 0) && this.panel.isGrayOnNoData) {\r\n\t\t\tthis.panelState = 'no-data-state';\r\n\t\t} else {\r\n\t\t\tthis.panelState = 'ok-state';\r\n\t\t}\r\n\t}\r\n\r\n\thandleCssDisplay() {\r\n\t\tthis.$panelContainer.removeClass('error-state warn-state disabled-state ok-state no-data-state');\r\n\t\tthis.$panelContainer.addClass(this.panelState);\r\n\r\n\t\tlet radius = _.isNumber(this.panel.cornerRadius) ? this.panel.cornerRadius : 0\r\n\t\tthis.$panelContainer.css('border-radius', radius + '%');\r\n\r\n\t\tlet okColor = (this.panel.isIgnoreOKColors) ? '' : this.panel.colors.ok;\r\n\r\n\t\tif (this.panel.colorMode === \"Panel\") {\r\n\t\t\tswitch(this.panelState) {\r\n\t\t\t\tcase 'disabled-state': this.$panelContainer.css('background-color', this.panel.colors.disable);break;\r\n\t\t\t\tcase 'error-state': this.$panelContainer.css('background-color', this.panel.colors.crit); this.crit_varibale=true;this.ok_varibale=false;this.warn_varibale=false;break;\r\n\t\t\t\tcase 'warn-state': this.$panelContainer.css('background-color', this.panel.colors.warn); this.crit_varibale=false;this.ok_varibale=false;this.warn_varibale=true;break;\r\n\t\t\t\tcase 'no-data-state': this.$panelContainer.css('background-color', this.panel.colors.disable); this.crit_varibale=false;this.ok_varibale=true;this.warn_varibale=false;break;\r\n\t\t\t\tdefault: this.$panelContainer.css('background-color', okColor); break;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.$panelContainer.css('background-color', '');\r\n\t\t}\r\n\t}\r\n\r\n\thandleMaxAlertsToShow() {\r\n\t\tif(this.panel.maxAlertNumber != null && this.panel.maxAlertNumber >= 0) {\r\n\t\t\tlet currentMaxAllowedAlerts = this.panel.maxAlertNumber;\r\n\t\t\tlet filteredOutAlerts = 0;\r\n\t\t\tlet arrayNamesToSlice = [\"disabled\", \"crit\", \"warn\", \"display\"];\r\n\t\t\tarrayNamesToSlice.forEach( arrayName => {\r\n\t\t\t\tlet originAlertCount = this[arrayName].length;\r\n\t\t\t\tthis[arrayName] = this[arrayName].slice(0,currentMaxAllowedAlerts);\r\n\t\t\t\tcurrentMaxAllowedAlerts = Math.max(currentMaxAllowedAlerts - this[arrayName].length, 0);\r\n\t\t\t\tfilteredOutAlerts += (originAlertCount - this[arrayName].length);\r\n\t\t\t});\r\n\r\n\t\t\tif(filteredOutAlerts > 0) {\r\n\t\t\t\tthis.extraMoreAlerts = \"+ \" + filteredOutAlerts + \" more\"\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tparseUri() {\r\n\t\tif (this.panel.links && this.panel.links.length > 0) {\r\n\t\t\tlet link = this.panel.links[0];\r\n\r\n\t\t\tif (link.type == \"absolute\") {\r\n\t\t\t\tthis.uri = link.url;\r\n\t\t\t} else {\r\n\t\t\t\tthis.uri = 'dashboard/' + link.dashUri;\r\n\t\t\t}\r\n\r\n\t\t\tif (link.params) {\r\n\t\t\t\tthis.uri +=  \"?\" + link.params;\r\n\t\t\t}\r\n\r\n\t\t\tthis.targetBlank = link.targetBlank;\r\n\t\t} else {\r\n\t\t\tthis.uri = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\tvalidateRegex(textRegex) {\r\n\t\tif(textRegex == null || textRegex.length == 0) {\r\n\t\t\treturn true\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tlet regex = new RegExp(textRegex);\r\n\t\t\treturn true\r\n\t\t} catch(e) {\r\n\t\t\treturn false\r\n\t\t}\r\n\t}\r\n\r\n\tstatic parseThresholds(metricOptions) {\r\n\t\tlet res = {};\r\n\r\n\t\tif (StatusPluginCtrl.isFloat(metricOptions.warn)) {\r\n\t\t\tres.warn = parseFloat(metricOptions.warn);\r\n\t\t\tres.warnIsNumber = true;\r\n\t\t} else if (metricOptions.warn instanceof Date) {\r\n\t\t\t// Convert Dates to Numbers and leverage existing threshold logic\r\n\t\t\tres.warn = metricOptions.warn.valueOf();\r\n\t\t\tres.warnIsNumber = true;\r\n\t\t} else {\r\n\t\t\tres.warn = metricOptions.warn;\r\n\t\t\tres.warnIsNumber = false;\r\n\t\t}\r\n\r\n\t\tif (StatusPluginCtrl.isFloat(metricOptions.crit)) {\r\n\t\t\tres.crit = parseFloat(metricOptions.crit);\r\n\t\t\tres.critIsNumber = true;\r\n\t\t} else if (metricOptions.crit instanceof Date) {\r\n\t\t\tres.crit = metricOptions.crit.valueOf();\r\n\t\t\tres.critIsNumber = true;\r\n\t\t} else {\r\n\t\t\tres.crit = metricOptions.crit;\r\n\t\t\tres.critIsNumber = false;\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\t}\r\n\r\n\tstatic isFloat(val) {\r\n\t\tif (!isNaN(val) && val.toString().toLowerCase().indexOf('e') == -1) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonDataReceived(dataList) {\r\n\t\tthis.series = dataList.map(StatusPluginCtrl.seriesHandler.bind(this));\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tonDataError() {\r\n\t\tthis.crit = [];\r\n\t\tthis.warn = [];\r\n\t}\r\n\r\n\tstatic seriesHandler(seriesData) {\r\n\t\tvar series = new TimeSeries({\r\n\t\t\tdatapoints: seriesData.datapoints,\r\n\t\t\talias: seriesData.target\r\n\t\t});\r\n\r\n\t\tseries.flotpairs = series.getFlotPairs(\"connected\");\r\n\r\n\t\treturn series;\r\n\t}\r\n\r\n\t$onDestroy() {\r\n\t\tif(this.timeoutId) clearInterval(this.timeoutId);\r\n\t}\r\n\r\n\tautoFlip() {\r\n\t\tif (this.timeoutId) clearInterval(this.timeoutId);\r\n\t\tif (this.panel.flipCard && (this.crit.length > 0 || this.warn.length > 0 || this.disabled.length > 0)) {\r\n\t\t\tthis.timeoutId = setInterval(() => {\r\n\t\t\t\tthis.$panelContainer.toggleClass(\"flipped\");\r\n\t\t\t}, this.panel.flipTime * 1000);\r\n\t\t}\r\n\t}\r\n\r\n\tlink(scope, elem, attrs, ctrl) {\r\n\t\tthis.$panelContainer = elem.find('.panel-container');\r\n\t\tthis.$panelContainer.addClass(\"st-card\");\r\n\t\tthis.$panelContoller = ctrl;\r\n\t}\r\n}\r\n\r\nStatusPluginCtrl.templateUrl = 'module.html';"]}