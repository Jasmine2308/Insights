<!--
*******************************************************************************
 * Copyright 2019 Cognizant Technology Solutions
 * 
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 * 
 *   http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 ****************************************************************************** -->

<div class="pageCss">

    <div layout layout-align="left" class="titleStyle">
        <div>Configuration |
            <a class="greenTitleTxt">Webhook Configuration </a>
        </div>
    </div>
    <div class="orangeStripCss"></div>

    <div layout layout-align="left" class="sectionHeadingStyle">
        <div layout>&nbsp; Webhook Configuration
            <span class="sectionSubHeading"> (Configure a WebHook)
            </span>
        </div>
    </div>

    <div>
        <div class="btnAlign">
            <button [disabled]="!showWebhook" mat-icon-button (click)="addWebHook()" [disabled]="iseditdisabled">
                <mat-icon title="Add New WebHook" class="mat-icon material-icons">
                    <!--usingBtnCss usingBtnCss-->
                    add_circle
                </mat-icon>
            </button>
            <button [disabled]="!showAddWebHook" *ngIf="!showAddWebHook" mat-icon-button (click)="list()">
                <mat-icon svgIcon="webhookDeactive" title="List Existing WebHooks" class="mat-icon material-icons">

                </mat-icon>
            </button>
            <button *ngIf="showAddWebHook" mat-icon-button (click)="list()">
                <mat-icon svgIcon="webhook" title="List Existing WebHooks" class="mat-icon material-icons">

                </mat-icon>
            </button>
            <button [disabled]="!enablesubscribe" mat-icon-button (click)="actionSubscribeOrUnsubscribe( true,selectedWebhook)">
                <mat-icon title="Save" class="mat-icon material-icons">
                    rss_feed
                </mat-icon>
            </button>

            <button [disabled]="!enableunsubscribe" *ngIf="!enableunsubscribe" mat-icon-button (click)="actionSubscribeOrUnsubscribe( false,selectedWebhook)">
                <mat-icon class="svgIconCss" svgIcon="unsubscribe_webhookDeactive">
                </mat-icon>
            </button>

            <button *ngIf="enableunsubscribe" mat-icon-button (click)="actionSubscribeOrUnsubscribe( false,selectedWebhook)">
                <mat-icon class="svgIconCss" svgIcon="unsubscribe_webhook">
                </mat-icon>
            </button>



            <button mat-icon-button (click)="editWebhook()" [disabled]="!enableEdit">
                <mat-icon title="Edit" class="mat-icon material-icons">
                    <!--usingBtnCss usingBtnCss-->
                    edit
                </mat-icon>
            </button>
            <button [disabled]="!showAddWebHook" mat-icon-button (click)="saveData(webhookName, selectedTool, eventToSubscribe, dataformat, mqchannel)">
                <mat-icon title="Save" class="mat-icon material-icons">
                    save
                </mat-icon>
            </button>

            <button mat-icon-button (click)="uninstallWebHook(selectedWebhook)" [disabled]="!enableDelete">
                <mat-icon title="Delete" class="mat-icon material-icons">
                    delete
                </mat-icon>
            </button>

            <button mat-icon-button (click)="Refresh()" [disabled]="!enableRefresh">
                <mat-icon title="Refresh" class="mat-icon material-icons">
                    cancel
                </mat-icon>
            </button>

        </div>

        <div *ngIf="showWebhook">
            <mat-radio-group [(ngModel)]="selectedWebhook">
                <table mat-table [dataSource]="webhookDatasource" class="mat-elevation-z8" style="margin-top:2% !important">
                    <!-- Radio Button Column -->

                    <ng-container matColumnDef="radio">
                        <th mat-header-cell *matHeaderCellDef class="tableHeaderCss"></th>
                        <td mat-cell *matCellDef="let element " style="width:5% !important">
                            <mat-radio-button [value]="element" color="primary" (click)="enableButtons(element)"></mat-radio-button>
                        </td>
                        <!-- [checked]="radioRefresh" -->
                    </ng-container>

                    <ng-container matColumnDef="WebHookName">
                        <th mat-header-cell *matHeaderCellDef class="tableHeaderCss">WebHook Name</th>
                        <td mat-cell *matCellDef="let element" style="width:15% !important">
                            {{element.webhookName}}
                        </td>
                    </ng-container>



                    <ng-container matColumnDef="ToolName">
                        <th mat-header-cell *matHeaderCellDef class="tableHeaderCss">Tool Name</th>
                        <td mat-cell *matCellDef="let element" style="width:15% !important">
                            {{element.toolName}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="EventName">
                        <th mat-header-cell *matHeaderCellDef class="tableHeaderCss">Events</th>
                        <td mat-cell *matCellDef="let element" style="width:10% !important">
                            {{element.eventName}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="DataType">
                        <th mat-header-cell *matHeaderCellDef class="tableHeaderCss">Data Format</th>
                        <td mat-cell *matCellDef="let element" style="width:10% !important">
                            {{element.dataFormat}} </td>
                    </ng-container>

                    <ng-container matColumnDef="MqChannel">
                        <th mat-header-cell *matHeaderCellDef class="tableHeaderCss">MQ Channel</th>
                        <td mat-cell *matCellDef="let element" style="width:20% !important">
                            {{element.mqChannel}} </td>
                    </ng-container>

                    <ng-container matColumnDef="Status">
                        <th mat-header-cell *matHeaderCellDef class="tableHeaderCss">Subscribed Status</th>
                        <td mat-cell *matCellDef="let element" style="width:15% !important">
                            {{element.subscribeStatus}} </td>
                    </ng-container>



                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"> </tr>
                </table>
            </mat-radio-group>
        </div>






        <div *ngIf="showAddWebHook">
            <table class="mat-elevation-z8 mat-table">
                <thead>
                    <tr class="mat-header-row" layout-align="start start">
                        <th colspan="3" class="tableHeaderCss mat-header-cell" style="height:40px;border-radius: 10px 10px 0 0;padding-left: 15px;padding-right: 65px">
                            <span class="mainHeaderText">Webhook Configuration</span>
                            <span class="infoHeaderText">(Please provide accurate details to Configure a Webhook)
                            </span>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="mat-row">
                        <td class="mat-cell" style="width:15%;padding: 0px 0px 0px 15px ;height: 60px;">
                            <span class="mainText">WebHook Name</span>

                        </td>
                        <td style="width: 30%">

                            <input type="text" [(ngModel)]="webhookName" (click)="toolNameenableSave()" name="webhookName"
                                style="width:250px; font-size: 15px !important;">




                        </td>
                        <td>
                            <span class="infoText">Please input a logical WebHook Name to make it simplier to
                                identify</span>
                        </td>
                    </tr>


                    <tr class="mat-row">
                        <td class="mat-cell" style="width:15%;padding: 0px 0px 0px 15px ;height: 60px;">
                            <span class="mainText">Select Tool</span>

                        </td>
                        <td style="width: 10%">
                            <div style="padding-top: 10px;margin-bottom: 10px;">

                                <!--   <input type="text" [(ngModel)]="webhookName" (click)="toolNameenableSave()" name="webhookName"
                                    style="width:250px;"> -->


                                <mat-select [(ngModel)]="selectedTool" required name="selectedTool" class="form-control"
                                    placeholder="Select Tool" style="width:230px;" color="primary">
                                    <mat-option *ngFor=" let tool of toolsArr | keyvalue" value="{{tool.value}}">{{tool.value}}</mat-option>
                                </mat-select>
                            </div>
                        </td>
                        <td>
                            <span class="infoText">Please select a Tool to Configure a WebHook </span>
                        </td>
                    </tr>





                    <tr class="mat-row">
                        <td class="mat-cell" style="width:15%;padding: 0px 0px 0px 15px ;height: 60px;">
                            <span class="mainText">Event to Subscribe</span>

                        </td>
                        <td style="width: 10%">
                            <div style="padding-top: 10px;margin-bottom: 10px;">

                                <input type="text" [(ngModel)]="eventToSubscribe" (click)="toolNameenableSave()" name="eventToSubscribe"
                                    style="width:250px; font-size: 15px !important;">
                            </div>
                        </td>
                        <td>
                            <span class="infoText">Please Ensure that the <b>Event Name </b>is an <b>exact match
                                </b>with
                                the
                                <b>Producers Event</b> </span>
                        </td>
                    </tr>
                    <tr class="mat-row">
                        <td class="mat-cell" style="width:15%;padding: 0px 0px 0px 15px ;height: 60px;">
                            <span class="mainText">Data Format</span>

                        </td>
                        <td style="width: 10%">
                            <div style="padding-top: 10px;margin-bottom: 10px;">

                                <mat-select [(ngModel)]="dataformat" required name="dataformat" class="form-control"
                                    placeholder="Select Data Format" style="width:230px;" color="primary">
                                    <mat-option *ngFor="let dataformat of dataformats" [value]="dataformat.value">
                                        {{dataformat.viewValue}}
                                    </mat-option>
                                </mat-select>
                            </div>
                        </td>
                        <td>
                            <span class="infoText">Please select either a JSON file or Application\Application.txt
                                file
                                as Data Format </span>
                        </td>
                    </tr>

                    <tr class="mat-row">
                        <td class="mat-cell" style="width:15%;padding: 0px 0px 0px 15px ;height: 60px;">
                            <span class="mainText">MQ Channel</span>

                        </td>
                        <td style="width: 10%">
                            <div style="padding-top: 10px;margin-bottom: 10px;">

                                <input type="text" [(ngModel)]="mqchannel" (click)="toolNameenableSave()" name="mqchannel"
                                    style="width:250px; font-size: 15px !important;">
                            </div>
                        </td>
                        <td>
                            <span class="infoText">Please select a MQ Channel Name for pushing the Data </span>
                        </td>
                    </tr>


                </tbody>
            </table>



        </div>